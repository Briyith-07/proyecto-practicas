{% extends 'base.html' %}
{% block title %}Descargar Reportes{% endblock %}

{% block content %}
<div class="container mt-5">

  <a href="/estadisticas/campa침as/" class="btn btn-secondary mb-3">Volver</a>

  <h2 class="text-center mb-4">
    游늯 <span class="text-primary">Descargar Reportes</span>
  </h2>

  <div class="card shadow p-4 mx-auto" style="max-width: 750px;">

    <!-- FORMULARIO -->
    <form action="{% url 'exportar_reportes' %}" method="GET" target="_blank">

      <!-- TIPO DE REPORTE -->
      <label class="fw-bold">Tipo de reporte:</label>
      <select id="tipo_reporte" name="tipo" class="form-select mb-4" required>
        <option value="">-- Seleccione --</option>
        <option value="usuarios">Usuarios</option>
        <option value="campa침as">Campa침as</option>
        <option value="grupos">Grupos</option>
        <option value="roles">Roles</option>  <!-- NUEVO -->
      </select>

      <!-- ========================================= -->
      <!-- USUARIOS -->
      <!-- ========================================= -->
      <div id="filtro_usuarios" class="mb-4" style="display:none;">
        <label class="fw-bold">Estado del usuario:</label>
        <select name="estado_usuario" class="form-select">
          <option value="">-- Seleccione --</option>
          <option value="todos">Todos</option>
          <option value="habilitados">Habilitados</option>
          <option value="inhabilitados">Inhabilitados</option>
        </select>
      </div>

      <!-- ========================================= -->
      <!-- CAMPA칌AS -->
      <!-- ========================================= -->
      <div id="filtro_campa침as" class="mb-4" style="display:none;">

        <label class="fw-bold mt-2">Estado de la campa침a:</label>
        <select name="estado_campa침a" class="form-select mb-3">
          <option value="">-- Seleccione --</option>
          <option value="activa">Activa</option>
          <option value="por_aprobacion">Por aprobaci칩n</option>
          <option value="finalizada">Finalizada</option>
          <option value="rechazada">Rechazada</option>
          <option value="aprobada">Aprobada</option>
        </select>

        <label class="fw-bold">Periodicidad:</label>
        <select name="periodicidad_campa침a" class="form-select mb-3">
          <option value="">-- Seleccione --</option>
          <option value="Diaria">Diaria</option>
          <option value="Semanal">Semanal</option>
          <option value="Mensual">Mensual</option>
        </select>

      </div>

      <!-- ========================================= -->
      <!-- PERIODICIDAD GENERAL -->
      <!-- ========================================= -->
      <div id="filtro_periodicidad" class="mb-4" style="display:none;">
        <label class="fw-bold">Periodicidad:</label>
        <select name="periodicidad" class="form-select">
          <option value="">-- Seleccione --</option>
          <option value="diaria">Diaria</option>
          <option value="semanal">Semanal</option>
          <option value="mensual">Mensual</option>
        </select>
      </div>

      <!-- ========================================= -->
      <!-- GRUPOS (QUITADO EL SELECT Y LABEL) -->
      <!-- ========================================= -->
      <div id="filtro_grupos" class="mb-4" style="display:none;"></div>

      <!-- ========================================= -->
      <!-- ROLES - NUEVO -->
      <!-- ========================================= -->
      <div id="filtro_roles" class="mb-4" style="display:none;"></div>


      <!-- FORMATO -->
      <label class="fw-bold mt-3">Formato:</label>
      <select name="formato" class="form-select mb-4" required>
        <option value="">-- Seleccione --</option>
        <option value="excel">Excel</option>
        <option value="pdf">PDF</option>
      </select>

      <!-- BOT칍N -->
      <button class="btn btn-primary w-100 mt-3" type="submit">
        Descargar Reporte
      </button>

    </form>

  </div>
</div>

<script>
  document.getElementById("tipo_reporte").addEventListener("change", function () {
      const tipo = this.value;

      // Ocultar todos los filtros
      const filtros = ["filtro_usuarios", "filtro_campa침as", "filtro_periodicidad", "filtro_grupos", "filtro_roles"];
      filtros.forEach(id => document.getElementById(id).style.display = "none");

      // Mostrar seg칰n tipo
      if (tipo === "usuarios") {
          document.getElementById("filtro_usuarios").style.display = "block";

      } else if (tipo === "campa침as") {
          document.getElementById("filtro_campa침as").style.display = "block";
          document.getElementById("filtro_periodicidad").style.display = "block";

      } else if (tipo === "grupos") {
          document.getElementById("filtro_grupos").style.display = "block";

      } else if (tipo === "roles") {
          document.getElementById("filtro_roles").style.display = "block";
      }
  });
</script>

{% endblock %}
