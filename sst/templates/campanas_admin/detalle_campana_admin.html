{% extends 'base.html' %}
{% block title %}Detalle de Campa침a Asignada{% endblock %}

{% block content %}
<div class="container mt-5">
  <h2 class="mb-4 text-center">Detalle de Campa침a Asignada</h2>

  <div class="card shadow p-4">

    <!-- Informaci칩n del empleado -->
    <p>
      <strong>Empleado:</strong>
      {% if asignacion.empleado %}
        {{ asignacion.empleado.first_name }} {{ asignacion.empleado.last_name }}
      {% else %}
        <span class="text-muted">No asignado</span>
      {% endif %}
    </p>

    <p>
      <strong>Estado actual:</strong>
      {% if asignacion.campa침a.estado == "Aprobada" %}
        游릭 Aprobada
      {% elif asignacion.campa침a.estado == "Rechazada" %}
        游댮 Rechazada
      {% else %}
        游리 Pendiente de aprobacion
      {% endif %}
    </p>

    <p><strong>Fecha de asignaci칩n:</strong> {{ asignacion.fecha_asignacion|date:"d/m/Y" }}</p>

    <hr>

    <!-- Informaci칩n de la campa침a -->
    <h5 class="mb-3">Informaci칩n de la Campa침a</h5>

    <p><strong>C칩digo:</strong> {{ asignacion.campa침a.codigo.codigo }}</p>
    <p><strong>Nombre:</strong> {{ asignacion.campa침a.codigo.nombre }}</p>
    <p><strong>Periodicidad:</strong> {{ asignacion.campa침a.periodicidad }}</p>

    <!-- Archivo de la campa침a -->
    <p><strong>Archivo de la Campa침a:</strong>
      {% if asignacion.campa침a.recurso %}
        <a href="{{ asignacion.campa침a.recurso.url }}" target="_blank" class="text-info">游늯 Ver recurso</a>
      {% elif asignacion.campa침a.multimedia %}
        <a href="{{ asignacion.campa침a.multimedia.url }}" target="_blank" class="text-info">游꿘 Ver multimedia</a>
      {% else %}
        <span class="text-muted">No se ha cargado ning칰n archivo.</span>
      {% endif %}
    </p>

    <hr>

    <!-- Evidencia -->
    <h5 class="mb-3">Evidencia del Empleado</h5>

    {% if evidencia and evidencia.archivo %}
      <p><strong>Archivo cargado:</strong></p>

      <a href="{{ evidencia.archivo.url }}" target="_blank" class="btn btn-outline-info mb-3">
        游늹 Ver evidencia del empleado
      </a>

      <p class="text-muted">
        <em>칔ltima actualizaci칩n: {{ evidencia.fecha_subida|date:"d/m/Y H:i" }}</em>
      </p>

    {% else %}
      <p class="text-muted">El empleado a칰n no ha subido evidencia.</p>
    {% endif %}

    <hr>

    <!-- Observaci칩n y botones -->
    <form method="post" class="mt-3">
      {% csrf_token %}

      <div class="mb-3">
        <label for="observacion" class="form-label"><strong>Observaci칩n del Administrador:</strong></label>
        <textarea name="observacion" id="observacion" class="form-control" rows="3"
          placeholder="Escribe aqu칤 alguna observaci칩n...">{% if asignacion.observacion_admin %}{{ asignacion.observacion_admin }}{% endif %}</textarea>
      </div>

      <div class="d-flex gap-2">
        <button type="submit" name="accion" value="aprobar" class="btn btn-success"
                {% if asignacion.campa침a.estado == "finalizada" %}disabled{% endif %}>
          Aprobar
        </button>

        <button type="submit" name="accion" value="rechazar" class="btn btn-danger"
                {% if asignacion.campa침a.estado == "finalizada" %}disabled{% endif %}>
          Rechazar
        </button>

        <a href="{% url 'campanas_admin' %}" class="btn btn-secondary">Volver</a>
      </div>

    </form>

  </div>
</div>
{% endblock %}
