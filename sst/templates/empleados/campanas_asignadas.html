{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container mt-5">
  <h2 class="mb-4 text-center">游늶 Campa침as Asignadas</h2>

  <!-- Filtros -->
  <form method="get" class="row g-2 mb-4 align-items-end">
    <!-- Estado -->
    <div class="col-6 col-md-3">
      <label for="estado" class="form-label">Estado</label>
      <select name="estado" id="estado" class="form-select form-select-sm">
        <option value="">Todos</option>
        <option value="activa" {% if filtros.estado == 'activa' %}selected{% endif %}>Activa</option>
        <option value="pausada" {% if filtros.estado == 'pausada' %}selected{% endif %}>Pausada</option>
        <option value="finalizada" {% if filtros.estado == 'finalizada' %}selected{% endif %}>Finalizada</option>
        <option value="en revisi칩n" {% if filtros.estado == 'en revisi칩n' %}selected{% endif %}>En revisi칩n</option>
      </select>
    </div>

    <!-- Periodicidad -->
    <div class="col-6 col-md-3">
      <label for="periodicidad" class="form-label">Periodicidad</label>
      <select name="periodicidad" id="periodicidad" class="form-select form-select-sm">
        <option value="">Todos</option>
        {% for p in periodicidades_disponibles %}
          <option value="{{ p }}" {% if filtros.periodicidad == p %}selected{% endif %}>{{ p }}</option>
        {% endfor %}
      </select>
    </div>

    <!-- Fecha desde -->
    <div class="col-6 col-md-2">
      <label for="fecha_desde" class="form-label">Desde</label>
      <input type="date" name="fecha_desde" id="fecha_desde" class="form-control form-control-sm" value="{{ filtros.fecha_desde }}">
    </div>

    <!-- Fecha hasta -->
    <div class="col-6 col-md-2">
      <label for="fecha_hasta" class="form-label">Hasta</label>
      <input type="date" name="fecha_hasta" id="fecha_hasta" class="form-control form-control-sm" value="{{ filtros.fecha_hasta }}">
    </div>

    <!-- Botones -->
    <div class="col-6 col-md-2 d-flex gap-1">
      <button type="submit" class="btn btn-primary btn-sm flex-fill">Filtrar</button>
      <a href="{% url 'campanas_asignadas' %}" class="btn btn-secondary btn-sm flex-fill">Limpiar</a>
    </div>
  </form>

  <!-- Tabla de campa침as -->
  {% if asignadas %}
    <div class="table-responsive">
      <table class="table table-bordered table-hover align-middle text-center shadow-sm">
        <thead class="table-primary">
          <tr>
            <th>Item</th>
            <th>C칩digo</th>
            <th>Nombre</th>
            <th>Detalle</th>
            <th>Estado</th>
            <th>Periodicidad</th>
            <th>Fecha de creaci칩n</th>
            <th>Fecha de vencimiento</th>
            <th>Acci칩n</th>
          </tr>
        </thead>
        <tbody>
          {% for a in asignadas %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ a.campa침a.codigo.codigo }}</td>
            <td>{{ a.nombre_campa침a }}</td>
            <td>{{ a.campa침a.detalle|truncatewords:15|default_if_none:"Sin detalle" }}</td>
            <td>
              {% if a.estado_actual == "finalizada" %}
                <span class="badge bg-danger">Finalizada</span>
              {% elif a.estado_actual == "pausada" %}
                <span class="badge bg-warning text-dark">Pausada</span>
              {% elif a.estado_actual == "activa" %}
                <span class="badge bg-success">Activa</span>
              {% else %}
                <span class="badge bg-secondary">{{ a.estado_actual|title }}</span>
              {% endif %}
            </td>
            <td>{{ a.campa침a.periodicidad|default:"-" }}</td>
            <td>{{ a.campa침a.fecha_creacion|date:"d/m/Y" }}</td>
            <td>{{ a.fecha_vencimiento|date:"d/m/Y" }}</td>
            <td>
              {% if a.estado_actual == "finalizada" %}
                <a href="{% url 'detalle_campania_realizada' a.campa침a.id %}" class="btn btn-outline-success btn-sm">游늹 Ver Evidencia</a>
              {% else %}
                <a href="{% url 'registrar_pausa' a.campa침a.id %}" class="btn btn-outline-primary btn-sm">游 Registrar Pausa</a>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="text-center mt-3">
      <a href="{% url 'dashboard_empleado' %}" class="btn btn-secondary btn-sm px-3">拘勇 Volver</a>
    </div>

  {% else %}
    <div class="alert alert-info text-center">No tienes campa침as asignadas actualmente.</div>
    <div class="text-center mt-3">
      <a href="{% url 'dashboard_empleado' %}" class="btn btn-secondary btn-sm px-3">拘勇 Volver</a>
    </div>
  {% endif %}
</div>
{% endblock %}
